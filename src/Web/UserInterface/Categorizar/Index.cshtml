<div ng-controller="categorizacaoController" ng-init="carregarFormulario()">

    <div class="panel-heading">
        <form name="categorizacaoForm">
            <div>Categorizando documento {{documentoId}}</div>

            <div class="input-group input-group-lg">
                <span class="input-group-addon"><i class="fa fa-lock"></i></span>
                
                <select class="form-control" ng-model="tipoDocumentoId" ng-options="tipodocumento.Id as tipodocumento.Nome for tipodocumento in tiposDeDocumento" ng-change="selecionarTipo()">
                    <option value="">Selecione o tipo do documento</option>
                </select>
            </div>
            
            <div class="form-group" ng-repeat="chave in chaves">
                <ng-form name="categorizacaoFieldForm">
                    <label>{{ chave.Nome }}</label>
                    
                    <hidden>
                        {{indexacao[$index].campoId = chave.Id}}
                        {{indexacao[$index].documentoId = documentoId}}
                    </hidden>

                    <ng-switch on="chave.TipoDado.Value">
                        <input type="text"
                               class="form-control"
                               name="index_{{$index}}"
                               ng-model="indexacao[$index].Valor"
                               ng-required="chave.Obrigatorio"
                               ng-switch-when="chave.TipoDado.Value == 32"
                               ng-pattern="^(((0[123456789]|10|11|12)([/])(([1][9][0-9][0-9])|([2][0-9][0-9][0-9]))))$"
                               placeholder="Informe o {{chave.Nome}}">

                        <input type="text"
                               class="form-control"
                               name="index_{{$index}}"
                               ng-model="indexacao[$index].Valor"
                               ng-required="chave.Obrigatorio"
                               ng-switch-when="chave.TipoDado.Value == 17"
                               ng-pattern="^([0-9]{2}[\.]?[0-9]{3}[\.]?[0-9]{3}[\/]?[0-9]{4}[-]?[0-9]{2})|([0-9]{3}[\.]?[0-9]{3}[\.]?[0-9]{3}[-]?[0-9]{2})$"
                               placeholder="Informe o {{chave.Nome}}">

                        <input type="number"
                               class="form-control"
                               name="index_{{$index}}"
                               ng-model="indexacao[$index].Valor"
                               ng-required="chave.Obrigatorio"
                               ng-switch-when="chave.TipoDado.Value == 1"
                               placeholder="Informe o {{chave.Nome}}">

                        <input type="date"
                               class="form-control"
                               name="index_{{$index}}"
                               ng-model="indexacao[$index].Valor"
                               ng-required="chave.Obrigatorio"
                               ng-switch-when="chave.TipoDado.Value == 3"
                               placeholder="Informe a {{chave.Nome}}">

                        <input type="date"
                               class="form-control"
                               name="index_{{$index}}"
                               ng-model="indexacao[$index].Valor"
                               ng-required="chave.Obrigatorio"
                               ng-switch-when="chave.TipoDado.Value == 9"
                               placeholder="Informe o {{chave.Nome}}">

                        <input type="text"
                               class="form-control"
                               name="index_{{$index}}"
                               ng-model="indexacao[$index].Valor"
                               ng-required="chave.Obrigatorio"
                               ng-switch-when="chave.TipoDado.Value == 2"
                               placeholder="Informe o {{chave.Nome}}">

                        <select class="form-control"
                                name="index_{{$index}}"
                                ng-required="chave.obrigatorio"
                                ng-model="indexacao[$index].Valor"
                                ng-switch-when="chave.TipoDado.Value == 8"
                                ng-options="linha for linha in chave.Lista">
                            <option value="">Selecione um valor</option>
                        </select>
                        
                        <input type="text"
                               class="form-control"
                               name="index_{{$index}}"
                               ng-model="indexacao[$index].Valor"
                               ng-required="chave.Obrigatorio"
                               ng-switch-default
                               placeholder="Informe o {{chave.Nome}}">

                        <p class="help-block" ng-show="categorizacaoFieldForm.index_{{$index}}.$invalid">Valor Inválido</p>

                    </ng-switch>
                </ng-form>
            </div>

            <button class="btn btn-primary" ng-click="salvarIndexacao()">Salvar</button>
        </form>
    </div>
</div>
